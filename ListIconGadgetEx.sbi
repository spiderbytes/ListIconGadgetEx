DeclareModule ListIconGadgetEx
  
  EnableExplicit
  
  Declare SetRowHeight(Gadget, RowHeight)
  Declare BindCellClick(Gadget, Callback)
  
  Declare SetEvenRowColor(Gadget, RowColor.s, SelectedRowColor.s, TextColor.s, SelectedTextColor.s)
  Declare SetOddRowColor (Gadget, RowColor.s, SelectedRowColor.s, TextColor.s, SelectedTextColor.s)
  
  Declare SetColumnHeaderAlignment(Gadget, Column, Alignment.s)
  Declare SetColumnAlignment(Gadget, Column, Alignment.s)
  
EndDeclareModule

Module ListIconGadgetEx
  
  EnableExplicit
  
  Macro GetGadgetID(Gadget)
    If IsGadget(Gadget) = 0 : ProcedureReturn : EndIf
    If GadgetType(Gadget) <> #PB_GadgetType_ListIcon : ProcedureReturn : EndIf
    Protected GadgetID = GadgetID(Gadget)
  EndMacro
  
  Macro GetGrid
    GetGadgetID(Gadget)
    ! var grid = v_gadgetid.gadget;
  EndMacro
  
  Procedure SetRowHeight(Gadget, RowHeight)
    
    GetGrid
    
    ! spider.DojoAspect.after( grid, 'renderRow', function( row, args ) {
    !		var div = $(row).find("td.dgrid-cell").find("div").find("div");
    ! 	div.css('height', v_rowheight + 'px');
    ! 	div.css('line-height', v_rowheight + 'px');
    ! 	return row;
    ! });	
    
  EndProcedure
  
  Procedure BindCellClick(Gadget, Callback)
    
    GetGrid
    
    ! grid.on('.dgrid-header .dgrid-cell:click', function (e) {
    ! 	v_callback(v_gadget, grid.cell(e).column.index, -1);
    ! });
    
    ! grid.on('.dgrid-row .dgrid-cell:click', function (e) {
    ! 	v_callback(v_gadget, grid.cell(e).column.index, grid.cell(e).row.id);
    ! });
    
  EndProcedure
  
  Procedure SetEvenRowColor(Gadget, RowColor.s, SelectedRowColor.s, TextColor.s, SelectedTextColor.s)
    
    GetGrid
    
    ! $('#EvenRowColorStyle_' + grid.id).remove();
    
    ! var style = "<style type='text/css' id='EvenRowColorStyle_" + grid.id + "'>" + 
    !             " #" + grid.id + " .dgrid-row-even.dgrid-selected {background:" + v_selectedrowcolor + ";color:" + v_selectedtextcolor + ";}" + 
    !             " #" + grid.id + " .dgrid-row-even {background:" + v_rowcolor + ";color:" + v_textcolor + ";}" + 
    !             "</style>"
    
    ! $(style).appendTo("head");
    
  EndProcedure
  
  Procedure SetOddRowColor(Gadget, RowColor.s, SelectedRowColor.s, TextColor.s, SelectedTextColor.s)
    
    GetGrid
    
    ! $('#OddRowColorStyle_' + grid.id).remove();
    
    ! var style = "<style type='text/css' id='OddRowColorStyle_" + grid.id + "'>" + 
    !             " #" + grid.id + " .dgrid-row-odd.dgrid-selected {background:" + v_selectedrowcolor + ";color:" + v_selectedtextcolor + ";}" + 
    !             " #" + grid.id + " .dgrid-row-odd {background:" + v_rowcolor + ";color:" + v_textcolor + ";}" + 
    !             "</style>"
    
    ! $(style).appendTo("head");
    
  EndProcedure
  
  Procedure SetColumnHeaderAlignment(Gadget, Column, Alignment.s)
    GetGrid
    ! var id = "ligcha_" + grid.id + "_" + v_column;
    ! $("#" + id).remove();
    ! $("<style id='" + id + "'>" + "#" + grid.id + " .dgrid-column-" + v_column + "[role='columnheader'] { text-align: " + v_alignment + ";}</style>").appendTo("head");
  EndProcedure
  
  Procedure SetColumnAlignment(Gadget, Column, Alignment.s)
    GetGrid
    ! var id = "ligca_" + grid.id + "_" + v_column;
    ! $("#" + id).remove();
    ! $("<style id='" + id + "'>" + "#" + grid.id + " .dgrid-column-" + v_column + "[role='gridcell'] { text-align: " + v_alignment + ";}</style>").appendTo("head");
  EndProcedure
  
EndModule